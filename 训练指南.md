# Gemini3 项目训练指南

## 环境配置

### 1. 安装Python依赖

确保您已安装以下Python包：

```bash
pip install torch torchvision
pip install numpy
pip install matplotlib
pip install seaborn  # 可选，用于更好的可视化
```

### 2. 验证安装

创建测试脚本验证环境：

```python
import torch
import numpy as np
import matplotlib.pyplot as plt

print(f"PyTorch版本: {torch.__version__}")
print(f"NumPy版本: {np.__version__}")
print(f"CUDA可用: {torch.cuda.is_available()}")
```

## 运行训练

### 方案1：使用优化版本（推荐）

```bash
python train_optimized.py
```

这个版本包含：
- 优化的超参数
- 更好的奖励设计
- 标准的训练曲线绘制
- 自动保存检查点

### 方案2：使用原始版本

```bash
python train.py
```

## 训练曲线说明

训练会生成 `training_curve.png` 文件，包含：

- **左图：累计奖励**
  - 横轴：迭代次数
  - 纵轴：累计奖励
  - 预期：从负值逐渐上升至正值

- **右图：损失值**
  - 横轴：迭代次数
  - 纵轴：总损失
  - 预期：快速下降后缓慢收敛

## 模型特点

### 双重注意力机制

1. **自注意力**：评估局部风险区域
2. **交叉注意力**：结合全局路径引导

### 奖励函数优化

- 进展奖励：鼓励靠近目标
- 距离奖励：接近目标时额外奖励
- 速度奖励：鼓励移动
- 减少惩罚：降低碰撞和时间惩罚

## 常见问题

### 1. 导入错误

如果出现模块导入错误：
- 检查所有Python文件是否在同一目录
- 确保已安装所有依赖包
- 检查Python路径设置

### 2. CUDA错误

如果出现CUDA相关错误：
- 检查PyTorch是否正确安装CUDA支持
- 可以强制使用CPU：`device = torch.device("cpu")`

### 3. 内存不足

如果出现内存不足：
- 减小批次大小（BATCH_SIZE）
- 减少更新间隔（UPDATE_TIMESTEP）
- 使用更小的模型

## 训练技巧

1. **课程学习**：
   - 前1000回合：简单地图
   - 1000-3000回合：复杂地图
   - 3000回合后：混合地图

2. **超参数调整**：
   - 学习率：1e-4 到 5e-4
   - 批次大小：64 到 256
   - 更新频率：1000 到 4000

3. **早停策略**：
   - 如果100回合内没有改进，降低学习率
   - 如果500回合没有改进，停止训练

## 可视化

训练完成后，可以使用：

```python
from visualize_attention import visualize_attention_weights

# 加载模型并可视化注意力权重
visualize_attention_weights(model, obs_dict, hidden_state)
```

## 保存和加载

### 保存模型
```python
torch.save(model.state_dict(), 'model.pth')
```

### 加载模型
```python
model.load_state_dict(torch.load('model.pth'))
```

## 性能优化建议

1. **使用GPU加速**：确保CUDA可用
2. **批处理**：增大批次大小
3. **梯度累积**：模拟更大批次
4. **混合精度**：使用AMP加速训练

## 联系支持

如果遇到问题：
1. 检查错误信息
2. 确认环境配置
3. 尝试简化版本
4. 查看训练日志